version: '2.0'

services:
    web:
        ports:
            - "8000:80"
        volumes:
            - .:/var/www/pastell

    phpmyadmin:
        image: phpmyadmin/phpmyadmin
        links:
            - db:db
        ports:
            - "8001:80"
        env_file:
            - .env

    db_test:
        image: mysql
        ports:
            - "8306:3306"
        environment:
            MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
            MYSQL_USER: ${MYSQL_USER_TEST}
            MYSQL_PASSWORD: ${MYSQL_PASSWORD_TEST}
            MYSQL_DATABASE: ${MYSQL_DATABASE_TEST}

    web_test:
        build: .
        ports:
            - "8003:80"
        volumes:
            - .:/var/www/pastell
        env_file:
            - .env
        environment:
            PASTELL_SITE_BASE: ${PASTELL_SITE_BASE_TEST}
            MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
            MYSQL_USER: ${MYSQL_USER_TEST}
            MYSQL_PASSWORD: ${MYSQL_PASSWORD_TEST}
            MYSQL_DATABASE: ${MYSQL_DATABASE_TEST}
            MYSQL_HOST: ${MYSQL_HOST_TEST}

