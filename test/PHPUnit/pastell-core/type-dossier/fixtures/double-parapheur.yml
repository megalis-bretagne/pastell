nom: 'Double parapheur'
type: 'Flux Généraux'
description: ''
connecteur:
    - signature
    - signature
affiche_one: false
formulaire:
    Information:
        titre:
            name: Titre
            type: text
            requis: true
            multiple: false
            commentaire: ''
            title: true
        document:
            name: Document
            type: file
            requis: true
            multiple: false
            commentaire: ''
        annexe:
            name: Annexe(s)
            type: file
            requis: false
            multiple: true
            commentaire: ''
    Cheminement:
        envoi_signature_1:
            name: 'Visa/Signature #1'
            type: checkbox
            onchange: cheminement-change
            default: checked
            read-only: true
        envoi_signature_2:
            name: 'Visa/Signature #2'
            type: checkbox
            onchange: cheminement-change
            default: checked
            read-only: true
    'iparapheur #1':
        envoi_iparapheur_1:
            no-show: true
        iparapheur_type_1:
            name: 'Type iparapheur'
            read-only: true
        iparapheur_sous_type_1:
            name: 'Sous-type iparapheur'
            requis: true
            index: true
            type: externalData
            choice-action: iparapheur-sous-type_1
            link_name: 'Sélectionner un sous-type'
        json_metadata_1:
            name: 'Métadonnées parapheur (JSON)'
            commentaire: 'Au format JSON {"cle1":"valeur1","cle2":"valeur2",...}'
            type: file
        has_date_limite_1:
            name: 'Utiliser une date limite'
            type: checkbox
        date_limite_1:
            name: 'Date limite'
            type: date
        annotation_publique_1:
            name: 'Annotation publique'
            type: textarea
        annotation_privee_1:
            name: 'Annotation privée'
            type: textarea
    'Parapheur FAST #1':
        envoi_fast_1:
            no-show: true
        fast_parapheur_circuit_1:
            name: 'Circuit sur le parapheur'
            type: externalData
            choice-action: iparapheur-sous-type_1
            link_name: 'Liste des circuits'
        fast_parapheur_circuit_configuration_1:
            name: 'Configuration du circuit à la volée (au format JSON)'
            commentaire: 'Si ce fichier est déposé, il remplace le circuit choisi dans le champ "Circuit sur le parapheur"'
            type: file
        fast_parapheur_email_destinataire_1:
            name: 'Email du destinataire'
            commentaire: "Email de la personne à qui l’on souhaite envoyer le document après sa signature<br />\nUniquement avec le mode \"circuit à la volée\""
        fast_parapheur_email_cc_1:
            name: 'Email des destinataires en copie carbone'
            commentaire: "Permet de rajouter des destinataires mais en copie carbone<br />\nUniquement avec le mode \"circuit à la volée\""
        fast_parapheur_agents_1:
            name: 'Emails des agents'
            commentaire: "Les emails des utilisateurs à rajouter en tant qu’agent. Séparé par des virgules<br />\nUniquement avec le mode \"circuit à la volée\""
    'Signature #1':
        iparapheur_dossier_id_1:
            name: '#ID dossier parapheur'
            read-only: true
        iparapheur_historique_1:
            name: 'Historique iparapheur'
            type: file
            read-only: true
        parapheur_last_message_1:
            name: 'Dernier message reçu du parapheur'
            read-only: true
        parapheur_date_signature_1:
            name: 'Date de dernière signature'
            type: date
            read-only: true
        has_signature_1:
            no-show: true
            read-only: true
        signature_1:
            name: 'Signature détachée'
            type: file
            read-only: true
        bordereau_signature_1:
            name: 'Bordereau de signature'
            type: file
            read-only: true
        document_original_1:
            name: 'Document original'
            type: file
            read-only: true
        multi_document_original_1:
            name: 'Multi-document(s) original'
            type: file
            multiple: true
            read-only: true
        iparapheur_annexe_sortie_1:
            name: 'Annexe(s) de sortie du parapheur'
            type: file
            multiple: true
            read-only: true
    'iparapheur #2':
        envoi_iparapheur_2:
            no-show: true
        iparapheur_type_2:
            name: 'Type iparapheur'
            read-only: true
        iparapheur_sous_type_2:
            name: 'Sous-type iparapheur'
            requis: true
            index: true
            type: externalData
            choice-action: iparapheur-sous-type_2
            link_name: 'Sélectionner un sous-type'
        json_metadata_2:
            name: 'Métadonnées parapheur (JSON)'
            commentaire: 'Au format JSON {"cle1":"valeur1","cle2":"valeur2",...}'
            type: file
        has_date_limite_2:
            name: 'Utiliser une date limite'
            type: checkbox
        date_limite_2:
            name: 'Date limite'
            type: date
        annotation_publique_2:
            name: 'Annotation publique'
            type: textarea
        annotation_privee_2:
            name: 'Annotation privée'
            type: textarea
    'Parapheur FAST #2':
        envoi_fast_2:
            no-show: true
        fast_parapheur_circuit_2:
            name: 'Circuit sur le parapheur'
            type: externalData
            choice-action: iparapheur-sous-type_2
            link_name: 'Liste des circuits'
        fast_parapheur_circuit_configuration_2:
            name: 'Configuration du circuit à la volée (au format JSON)'
            commentaire: 'Si ce fichier est déposé, il remplace le circuit choisi dans le champ "Circuit sur le parapheur"'
            type: file
        fast_parapheur_email_destinataire_2:
            name: 'Email du destinataire'
            commentaire: "Email de la personne à qui l’on souhaite envoyer le document après sa signature<br />\nUniquement avec le mode \"circuit à la volée\""
        fast_parapheur_email_cc_2:
            name: 'Email des destinataires en copie carbone'
            commentaire: "Permet de rajouter des destinataires mais en copie carbone<br />\nUniquement avec le mode \"circuit à la volée\""
        fast_parapheur_agents_2:
            name: 'Emails des agents'
            commentaire: "Les emails des utilisateurs à rajouter en tant qu’agent. Séparé par des virgules<br />\nUniquement avec le mode \"circuit à la volée\""
    'Signature #2':
        iparapheur_dossier_id_2:
            name: '#ID dossier parapheur'
            read-only: true
        iparapheur_historique_2:
            name: 'Historique iparapheur'
            type: file
            read-only: true
        parapheur_last_message_2:
            name: 'Dernier message reçu du parapheur'
            read-only: true
        parapheur_date_signature_2:
            name: 'Date de dernière signature'
            type: date
            read-only: true
        has_signature_2:
            no-show: true
            read-only: true
        signature_2:
            name: 'Signature détachée'
            type: file
            read-only: true
        bordereau_signature_2:
            name: 'Bordereau de signature'
            type: file
            read-only: true
        document_original_2:
            name: 'Document original'
            type: file
            read-only: true
        multi_document_original_2:
            name: 'Multi-document(s) original'
            type: file
            multiple: true
            read-only: true
        iparapheur_annexe_sortie_2:
            name: 'Annexe(s) de sortie du parapheur'
            type: file
            multiple: true
            read-only: true
champs-affiches:
    - titre
    - dernier_etat
    - date_dernier_etat
champs-recherche-avancee:
    - type
    - id_e
    - lastetat
    - last_state_begin
    - etatTransit
    - state_begin
    - notEtatTransit
    - search
page-condition:
    'iparapheur #1':
        envoi_iparapheur_1: true
    'Parapheur FAST #1':
        envoi_fast_1: true
    'Signature #1':
        has_signature_1: true
    'iparapheur #2':
        envoi_iparapheur_2: true
    'Parapheur FAST #2':
        envoi_fast_2: true
    'Signature #2':
        has_signature_2: true
action:
    creation:
        name-action: Créer
        name: Créé
        rule:
            no-last-action: ''
    modification:
        name-action: Modifier
        name: 'En cours de rédaction'
        rule:
            last-action:
                - creation
                - modification
                - importation
                - recu-iparapheur_1
                - send-signature-error_1
                - send-signature-error_2
    supression:
        name-action: Supprimer
        name: Supprimé
        rule:
            last-action:
                - creation
                - modification
                - importation
                - termine
                - fatal-error
                - rejet-iparapheur_1
                - send-signature-error_1
                - erreur-verif-iparapheur_1
                - rejet-iparapheur_2
                - send-signature-error_2
                - erreur-verif-iparapheur_2
        action-class: Supprimer
        warning: 'Êtes-vous sûr ?'
    importation:
        name: 'Importation du document'
        rule:
            role_id_e: no-role
        action-automatique: orientation
    orientation:
        name: 'Envoi du document'
        name-action: 'Envoyer le document'
        rule:
            last-action:
                - creation
                - modification
                - importation
                - recu-iparapheur_1
                - recu-iparapheur_2
            document_is_valide: true
        action-class: OrientationTypeDossierPersonnalise
    termine:
        name: 'Traitement terminé'
        rule:
            role_id_e: no-role
    reouverture:
        name: 'Rouvrir le dossier'
        rule:
            last-action:
                - termine
        action-class: Reopen
    cheminement-change:
        no-workflow: true
        rule:
            role_id_e: 'no-role,'
        action-class: CheminementChangeTypeDossierPersonnalise
    preparation-send-iparapheur_1:
        name: "Préparation de l'envoi au parapheur #1"
        rule:
            role_id_e: no-role
        action-automatique: send-iparapheur_1
        num-same-connecteur: '0'
    send-iparapheur_1:
        name-action: 'Transmettre au parapheur #1'
        name: 'Transmis au parapheur #1'
        rule:
            last-action:
                - preparation-send-iparapheur_1
                - send-signature-error_1
        action-class: StandardAction
        connecteur-type: signature
        connecteur-type-action: SignatureEnvoie
        connecteur-type-mapping:
            iparapheur_type: iparapheur_type_1
            iparapheur_sous_type: iparapheur_sous_type_1
            iparapheur_dossier_id: iparapheur_dossier_id_1
            json_metadata: json_metadata_1
            fast_parapheur_circuit: fast_parapheur_circuit_1
            fast_parapheur_circuit_configuration: fast_parapheur_circuit_configuration_1
            fast_parapheur_email_destinataire: fast_parapheur_email_destinataire_1
            fast_parapheur_email_cc: fast_parapheur_email_cc_1
            fast_parapheur_agents: fast_parapheur_agents_1
            send-signature-error: send-signature-error_1
            iparapheur_annotation_publique: annotation_publique_1
            iparapheur_annotation_privee: annotation_privee_1
            iparapheur_has_date_limite: has_date_limite_1
            iparapheur_date_limite: date_limite_1
            objet: titre
            document: document
            autre_document_attache: annexe
        action-automatique: verif-iparapheur_1
        num-same-connecteur: '0'
    send-signature-error_1:
        name: "Erreur lors de l'envoi du dossier à la signature #1"
        editable-content:
            - iparapheur_sous_type_1
            - json_metadata_1
            - has_date_limite_1
            - date_limite_1
            - fast_parapheur_circuit_1
            - fast_parapheur_circuit_configuration_1
            - fast_parapheur_email_destinataire_1
            - fast_parapheur_email_cc_1
            - fast_parapheur_agents_1
        rule:
            role_id_e: no-role
        modification-no-change-etat: true
        num-same-connecteur: '0'
    verif-iparapheur_1:
        name-action: 'Vérifier le statut de signature #1'
        name: 'Vérification de la signature #1'
        rule:
            last-action:
                - erreur-verif-iparapheur_1
                - send-iparapheur_1
        action-class: StandardAction
        connecteur-type: signature
        connecteur-type-action: SignatureRecuperation
        connecteur-type-mapping:
            iparapheur_historique: iparapheur_historique_1
            parapheur_last_message: parapheur_last_message_1
            parapheur_date_signature: parapheur_date_signature_1
            has_signature: has_signature_1
            signature: signature_1
            document_original: document_original_1
            multi_document_original: multi_document_original_1
            bordereau: bordereau_signature_1
            iparapheur_annexe_sortie: iparapheur_annexe_sortie_1
            iparapheur_dossier_id: iparapheur_dossier_id_1
            recu-iparapheur: recu-iparapheur_1
            rejet-iparapheur: rejet-iparapheur_1
            erreur-verif-iparapheur: erreur-verif-iparapheur_1
            iparapheur_has_date_limite: has_date_limite_1
            iparapheur_date_limite: date_limite_1
            objet: titre
            document: document
            autre_document_attache: annexe
        num-same-connecteur: '0'
    erreur-verif-iparapheur_1:
        name: 'Erreur lors de la vérification du statut de signature #1'
        rule:
            role_id_e: no-role
        num-same-connecteur: '0'
    recu-iparapheur_1:
        name: 'Signature récupérée #1'
        rule:
            role_id_e: no-role
        action-automatique: orientation
        num-same-connecteur: '0'
        editable-content:
            - envoi_signature_2
            - envoi_iparapheur_2
            - iparapheur_sous_type_2
            - json_metadata_2
            - has_date_limite_2
            - date_limite_2
            - annotation_publique_2
            - annotation_privee_2
            - envoi_fast_2
            - fast_parapheur_circuit_2
            - fast_parapheur_circuit_configuration_2
            - fast_parapheur_email_destinataire_2
            - fast_parapheur_email_cc_2
            - fast_parapheur_agents_2
        modification-no-change-etat: true
    rejet-iparapheur_1:
        name: 'Signature refusée #1'
        rule:
            role_id_e: no-role
        num-same-connecteur: '0'
    iparapheur-sous-type_1:
        name: 'Liste des sous-type iparapheur #1'
        no-workflow: true
        rule:
            role_id_e: no-role
        action-class: IparapheurSousType
        connecteur-type-mapping:
            iparapheur_type: iparapheur_type_1
            iparapheur_sous_type: iparapheur_sous_type_1
            fast_parapheur_circuit: fast_parapheur_circuit_1
        num-same-connecteur: '0'
    preparation-send-iparapheur_2:
        name: "Préparation de l'envoi au parapheur #2"
        rule:
            role_id_e: no-role
        action-automatique: send-iparapheur_2
        num-same-connecteur: '1'
    send-iparapheur_2:
        name-action: 'Transmettre au parapheur #2'
        name: 'Transmis au parapheur #2'
        rule:
            last-action:
                - preparation-send-iparapheur_2
                - send-signature-error_2
        action-class: StandardAction
        connecteur-type: signature
        connecteur-type-action: SignatureEnvoie
        connecteur-type-mapping:
            iparapheur_type: iparapheur_type_2
            iparapheur_sous_type: iparapheur_sous_type_2
            iparapheur_dossier_id: iparapheur_dossier_id_2
            json_metadata: json_metadata_2
            fast_parapheur_circuit: fast_parapheur_circuit_2
            fast_parapheur_circuit_configuration: fast_parapheur_circuit_configuration_2
            fast_parapheur_email_destinataire: fast_parapheur_email_destinataire_2
            fast_parapheur_email_cc: fast_parapheur_email_cc_2
            fast_parapheur_agents: fast_parapheur_agents_2
            send-signature-error: send-signature-error_2
            iparapheur_annotation_publique: annotation_publique_2
            iparapheur_annotation_privee: annotation_privee_2
            iparapheur_has_date_limite: has_date_limite_2
            iparapheur_date_limite: date_limite_2
            objet: titre
            document: document
            autre_document_attache: annexe
        action-automatique: verif-iparapheur_2
        num-same-connecteur: '1'
    send-signature-error_2:
        name: "Erreur lors de l'envoi du dossier à la signature #2"
        editable-content:
            - iparapheur_sous_type_2
            - json_metadata_2
            - has_date_limite_2
            - date_limite_2
            - fast_parapheur_circuit_2
            - fast_parapheur_circuit_configuration_2
            - fast_parapheur_email_destinataire_2
            - fast_parapheur_email_cc_2
            - fast_parapheur_agents_2
        rule:
            role_id_e: no-role
        modification-no-change-etat: true
        num-same-connecteur: '1'
    verif-iparapheur_2:
        name-action: 'Vérifier le statut de signature #2'
        name: 'Vérification de la signature #2'
        rule:
            last-action:
                - erreur-verif-iparapheur_2
                - send-iparapheur_2
        action-class: StandardAction
        connecteur-type: signature
        connecteur-type-action: SignatureRecuperation
        connecteur-type-mapping:
            iparapheur_historique: iparapheur_historique_2
            parapheur_last_message: parapheur_last_message_2
            parapheur_date_signature: parapheur_date_signature_2
            has_signature: has_signature_2
            signature: signature_2
            document_original: document_original_2
            multi_document_original: multi_document_original_2
            bordereau: bordereau_signature_2
            iparapheur_annexe_sortie: iparapheur_annexe_sortie_2
            iparapheur_dossier_id: iparapheur_dossier_id_2
            recu-iparapheur: recu-iparapheur_2
            rejet-iparapheur: rejet-iparapheur_2
            erreur-verif-iparapheur: erreur-verif-iparapheur_2
            iparapheur_has_date_limite: has_date_limite_2
            iparapheur_date_limite: date_limite_2
            objet: titre
            document: document
            autre_document_attache: annexe
        num-same-connecteur: '1'
    erreur-verif-iparapheur_2:
        name: 'Erreur lors de la vérification du statut de signature #2'
        rule:
            role_id_e: no-role
        num-same-connecteur: '1'
    recu-iparapheur_2:
        name: 'Signature récupérée #2'
        rule:
            role_id_e: no-role
        action-automatique: orientation
        num-same-connecteur: '1'
    rejet-iparapheur_2:
        name: 'Signature refusée #2'
        rule:
            role_id_e: no-role
        num-same-connecteur: '1'
    iparapheur-sous-type_2:
        name: 'Liste des sous-type iparapheur #2'
        no-workflow: true
        rule:
            role_id_e: no-role
        action-class: IparapheurSousType
        connecteur-type-mapping:
            iparapheur_type: iparapheur_type_2
            iparapheur_sous_type: iparapheur_sous_type_2
            fast_parapheur_circuit: fast_parapheur_circuit_2
        num-same-connecteur: '1'
