#!/usr/bin/env php
<?php

/**
 * @var ObjectInstancier $objectInstancier
 */


use Pastell\Helpers\ClassHelper;
use Symfony\Component\Console\Application;

if (false === in_array(PHP_SAPI, ['cli', 'phpdbg', 'embed'], true)) {
    echo 'Warning: The console should be invoked via the CLI version of PHP, not the ' . PHP_SAPI . ' SAPI' . PHP_EOL;
}

require dirname(__DIR__) . DIRECTORY_SEPARATOR . 'init.php';

// run the command application
$application = new Application();

$all_command = ClassHelper::findRecursive("Pastell\Command");
foreach($all_command as $commandClassName) {
    $reflexionClass = new ReflectionClass($commandClassName);
    if ($reflexionClass->isAbstract()){
        continue;
    }
    /** @var Pastell\Command\BaseCommand $commandClass */
    $commandClass = $objectInstancier->getInstance($commandClassName);

    $application->add($commandClass);
}
$application->run();
