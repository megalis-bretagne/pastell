nom: Actes
type: 'Actes administratifs'
description: "Type de dossier permettant d'envoyer des Actes en signature, TDT, GED, SAE"
connecteur:
    - transformation
    - signature
    - TdT
    - GED
    - 'Bordereau SEDA'
    - SAE
affiche_one: false
formulaire:
    Informations:
        objet:
            name: Objet
            type: textarea
            requis: true
            multiple: false
            commentaire: 'Entre 1 et 499 caractères'
            preg_match: '#^.{1,499}$#us'
            preg_match_error: 'entre 1 et 499 caractères'
            title: true
        fichier_acte:
            name: 'Fichier Acte'
            type: file
            requis: true
            multiple: false
            commentaire: 'Format PDF ou XML'
            content-type: 'application/pdf, application/xml'
        annexe:
            name: Annexe(s)
            type: file
            requis: false
            multiple: true
            commentaire: 'Attention ! La taille totale des documents acte + annexes ne peut pas dépasser 150 Mo'
            onchange: autre_document_attache-change
        metadonnees:
            name: 'Fichier contenant les métadonnées'
            type: file
            requis: false
            multiple: false
            commentaire: 'Préférentiellement au format JSON, XML possible'
    Cheminement:
        envoi_transformation:
            name: Transformation
            type: checkbox
            onchange: cheminement-change
            default: checked
            read-only: true
        envoi_signature:
            name: Signature
            type: checkbox
            onchange: cheminement-change
            default: ''
            read-only: false
        envoi_transformation_fixe:
            name: 'Transformation Fixe (date)'
            type: checkbox
            onchange: cheminement-change
            default: checked
            read-only: true
        envoi_tdt_actes:
            name: 'Préfecture (via Tdt)'
            type: checkbox
            onchange: cheminement-change
            default: ''
            read-only: false
        envoi_depot:
            name: 'Dépôt (GED, FTP, ...)'
            type: checkbox
            onchange: cheminement-change
            default: ''
            read-only: false
        envoi_sae:
            name: "Système d'archivage électronique"
            type: checkbox
            onchange: cheminement-change
            default: ''
            read-only: false
    Transformation:
        has_transformation:
            no-show: true
            read-only: true
        transformation_file:
            name: Transformations
            type: file
            visionneuse: Pastell\Viewer\TransformationViewer
            read-only: true
            visionneuse-no-link: true
    iparapheur:
        envoi_iparapheur:
            no-show: true
        iparapheur_type:
            name: 'Type iparapheur'
            read-only: true
        iparapheur_sous_type:
            name: 'Sous-type iparapheur'
            requis: true
            index: true
            type: externalData
            choice-action: iparapheur-sous-type
            link_name: 'Sélectionner un sous-type'
        json_metadata:
            name: 'Métadonnées parapheur (JSON)'
            commentaire: 'Au format JSON {"cle1":"valeur1","cle2":"valeur2",...}'
            type: file
        has_date_limite:
            name: 'Utiliser une date limite'
            type: checkbox
        date_limite:
            name: 'Date limite'
            type: date
        primo_signature_detachee:
            name: 'Primo-signature détachée'
            type: file
            multiple: true
            commentaire: 'format XML ou pkcs7'
        annotation_publique:
            name: 'Annotation publique'
            type: textarea
        annotation_privee:
            name: 'Annotation privée'
            type: textarea
    'Parapheur FAST':
        envoi_fast:
            no-show: true
        fast_parapheur_circuit:
            name: 'Circuit sur le parapheur'
            type: externalData
            choice-action: iparapheur-sous-type
            link_name: 'Liste des circuits'
        fast_parapheur_circuit_configuration:
            name: 'Configuration du circuit à la volée (au format JSON)'
            commentaire: 'Si ce fichier est déposé, il remplace le circuit choisi dans le champ "Circuit sur le parapheur"'
            type: file
        fast_parapheur_email_destinataire:
            name: 'Email du destinataire'
            commentaire: "Email de la personne à qui l’on souhaite envoyer le document après sa signature<br />\nUniquement avec le mode \"circuit à la volée\""
        fast_parapheur_email_cc:
            name: 'Email des destinataires en copie carbone'
            commentaire: "Permet de rajouter des destinataires mais en copie carbone<br />\nUniquement avec le mode \"circuit à la volée\""
        fast_parapheur_agents:
            name: 'Emails des agents'
            commentaire: "Les emails des utilisateurs à rajouter en tant qu’agent. Séparé par des virgules<br />\nUniquement avec le mode \"circuit à la volée\""
    Signature:
        iparapheur_dossier_id:
            name: '#ID dossier parapheur'
            read-only: true
        iparapheur_historique:
            name: 'Historique iparapheur'
            type: file
            read-only: true
        parapheur_last_message:
            name: 'Dernier message reçu du parapheur'
            read-only: true
        parapheur_date_signature:
            name: 'Date de dernière signature'
            type: date
            read-only: true
        has_signature:
            no-show: true
            read-only: true
        signature:
            name: 'Signature détachée'
            type: file
            read-only: true
        bordereau_signature:
            name: 'Bordereau de signature'
            type: file
            read-only: true
        document_original:
            name: 'Document original'
            type: file
            read-only: true
        multi_document_original:
            name: 'Multi-document(s) original'
            type: file
            multiple: true
            read-only: true
        iparapheur_annexe_sortie:
            name: 'Annexe(s) de sortie du parapheur'
            type: file
            multiple: true
            read-only: true
    'Transformation Fixe':
        has_transformation_fixe:
            no-show: true
            read-only: true
        transformation_fixe_file:
            name: Transformations
            type: file
            visionneuse: Pastell\Viewer\TransformationViewer
            read-only: true
            visionneuse-no-link: true
    Acte:
        acte_nature:
            name: "Nature de l'acte"
            type: select
            requis: true
            value:
                3: 'Actes individuels'
                2: 'Actes réglementaires'
                6: Autres
                4: 'Contrats, conventions et avenants'
                1: Délibérations
                5: 'Documents budgétaires et financiers'
            onchange: autre_document_attache-change
        numero_de_lacte:
            name: "Numéro de l'acte"
            requis: true
            commentaire: '15 caractères maximum (chiffres, lettres en majuscule ou _)'
            preg_match: '#^[0-9A-Z_]{1,15}$#'
            preg_match_error: '15 caractères maximum (chiffres, lettres en majuscule ou _)'
            index: true
        date_de_lacte:
            name: "Date de l'acte"
            type: date
            default: now
            requis: true
            commentaire: 'Date de la décision'
        document_papier:
            name: 'Envoi de documents papiers complémentaires'
            type: checkbox
        classification:
            name: 'Classification en matière et sous-matière'
            type: externalData
            requis: true
            link_name: 'Sélectionner dans la classification en matière et sous-matière'
            choice-action: classification
        type_piece:
            name: 'Typologie des pièces'
            type: externalData
            link_name: 'Sélectionner des types de pièces'
            choice-action: type-piece
            edit-only: true
            requis: true
        type_piece_fichier:
            name: 'Typologie des pièces'
            type: file
            visionneuse: Pastell\Viewer\TypologyActesViewer
            read-only: true
            requis: true
            visionneuse-no-link: true
        type_acte:
            no-show: true
            onchange: typology-change-by-api
        type_pj:
            no-show: true
            onchange: typology-change-by-api
    'Retour Tdt':
        has_bordereau:
            no-show: true
            read-only: true
        tedetis_transaction_id:
            name: 'Identifiant de la transaction sur le TdT'
            read-only: true
        bordereau:
            name: "Bordereau d'acquittement"
            type: file
            read-only: true
        aractes:
            name: 'Accusé de réception technique'
            type: file
            commentaire: 'Accusé de réception (XML) envoyé par la préfecture'
            read-only: true
        acte_tamponne:
            name: 'Acte tamponné par le TdT'
            type: file
            read-only: true
        annexes_tamponnees:
            name: 'Annexe(s) tamponnée(s) par le TdT'
            type: file
            multiple: true
            read-only: true
        date_ar:
            name: "Date de l'accusé de réception"
            type: date
            read-only: true
        acte_publication_date:
            name: "Date de publication de l'acte"
            type: date
    Annulation:
        has_annulation:
            no-show: true
            read-only: true
        date_ar_annulation:
            name: "Date de l'accusé de réception d'annulation"
            type: date
            read-only: true
        tedetis_annulation_id:
            name: "Identifiant de la transaction d'annulation"
            read-only: true
        aractes_annulation:
            name: "Accusé de réception d'annulation"
            type: file
            commentaire: 'Accusé de réception (XML) envoyé par la préfecture'
            read-only: true
    'Retour GED':
        has_ged_document_id:
            no-show: true
            read-only: true
        ged_document_id_file:
            name: 'Identifiants des documents sur la GED'
            type: file
            visionneuse: Pastell\Viewer\GedIdDocumentsViewer
            read-only: true
            requis: true
            visionneuse-no-link: true
    SAE:
        sae_show:
            no-show: true
        journal:
            name: 'Faisceau de preuves'
            type: file
        date_journal_debut:
            name: 'Date du premier évènement journalisé'
        date_cloture_journal:
            name: 'Date de clôture du journal'
        date_cloture_journal_iso8601:
            name: 'Date de clôture du journal (iso 8601)'
        sae_transfert_id:
            name: 'Identifiant de transfert'
            index: true
        sae_bordereau:
            name: 'Bordereau SEDA'
            type: file
        sae_archive:
            name: "Paquet d'archive (SIP)"
            type: file
        ar_sae:
            type: file
            name: 'Accusé de réception SAE'
        sae_ack_comment:
            name: "Commentaire de l'accusé de réception"
        reply_sae:
            type: file
            name: 'Réponse du SAE'
        sae_archival_identifier:
            name: "Identifiant de l'archive sur le SAE"
        sae_atr_comment:
            name: 'Commentaire de la réponse du SAE'
champs-affiches:
    - titre
    - dernier_etat
    - date_dernier_etat
champs-recherche-avancee:
    - type
    - id_e
    - lastetat
    - last_state_begin
    - etatTransit
    - state_begin
    - notEtatTransit
    - search
page-condition:
    Transformation:
        has_transformation: true
    iparapheur:
        envoi_iparapheur: true
    'Parapheur FAST':
        envoi_fast: true
    Signature:
        has_signature: true
    'Transformation Fixe':
        has_transformation_fixe: true
    Acte:
        envoi_tdt_actes: true
    'Retour Tdt':
        has_bordereau: true
    Annulation:
        has_annulation: true
    'Retour GED':
        has_ged_document_id: true
    SAE:
        sae_show: true
action:
    creation:
        name-action: Créer
        name: Créé
        rule:
            no-last-action: ''
    modification:
        name-action: Modifier
        name: 'En cours de rédaction'
        rule:
            last-action:
                - creation
                - modification
                - importation
                - transformation
                - recu-iparapheur
                - transformation-fixe
                - acquiter-tdt
                - send-ged
                - send-signature-error
                - send-tdt-erreur
                - acquiter-tdt
                - send-ged
                - accepter-sae
                - termine
    supression:
        name-action: Supprimer
        name: Supprimé
        rule:
            last-action:
                - creation
                - modification
                - importation
                - termine
                - fatal-error
                - transformation-error
                - rejet-iparapheur
                - send-signature-error
                - erreur-verif-iparapheur
                - transformation-fixe-error
                - send-tdt-erreur
                - annuler-tdt
                - error-ged
                - rejet-sae
        action-class: Supprimer
        warning: 'Êtes-vous sûr ?'
    importation:
        name: 'Importation du document'
        rule:
            role_id_e: no-role
        action-automatique: orientation
    orientation:
        name: 'Envoi du document'
        name-action: 'Envoyer le document'
        rule:
            last-action:
                - creation
                - modification
                - importation
                - transformation
                - recu-iparapheur
                - transformation-fixe
                - acquiter-tdt
                - send-ged
                - accepter-sae
            document_is_valide: true
        action-class: OrientationTypeDossierPersonnalise
    termine:
        name: 'Traitement terminé'
        rule:
            role_id_e: no-role
        editable-content:
            - acte_publication_date
        modification-no-change-etat: true
    reouverture:
        name: 'Rouvrir le dossier'
        rule:
            last-action:
                - termine
        action-class: Reopen
    cheminement-change:
        no-workflow: true
        rule:
            role_id_e: 'no-role,'
        action-class: CheminementChangeTypeDossierPersonnalise
    preparation-transformation:
        name: 'Préparation à la transformation'
        rule:
            role_id_e: no-role
        action-automatique: transformation
    transformation:
        name-action: 'Transformer le document'
        name: 'Transformation du document'
        rule:
            last-action:
                - preparation-transformation
                - transformation-error
        action-class: StandardAction
        action-automatique: orientation
        connecteur-type: transformation
        connecteur-type-action: TransformationTransform
        connecteur-type-mapping:
            transformation_file: transformation_file
            has_transformation: has_transformation
        editable-content:
            - envoi_signature
            - envoi_transformation_fixe
            - envoi_tdt_actes
            - envoi_depot
            - envoi_sae
            - envoi_iparapheur
            - iparapheur_sous_type
            - json_metadata
            - has_date_limite
            - date_limite
            - primo_signature_detachee
            - annotation_publique
            - annotation_privee
            - envoi_fast
            - fast_parapheur_circuit
            - fast_parapheur_circuit_configuration
            - fast_parapheur_email_destinataire
            - fast_parapheur_email_cc
            - fast_parapheur_agents
            - acte_nature
            - numero_de_lacte
            - date_de_lacte
            - document_papier
            - classification
            - type_piece
            - type_acte
            - type_pj
            - acte_publication_date
            - sae_show
            - journal
            - date_journal_debut
            - date_cloture_journal
            - date_cloture_journal_iso8601
            - sae_transfert_id
            - sae_bordereau
            - sae_archive
            - ar_sae
            - sae_ack_comment
            - reply_sae
            - sae_archival_identifier
            - sae_atr_comment
        modification-no-change-etat: true
    transformation-error:
        name: 'Erreur lors de la transformation du dossier'
        rule:
            role_id_e: no-role
    preparation-send-iparapheur:
        name: "Préparation de l'envoi au parapheur"
        rule:
            role_id_e: no-role
        action-automatique: send-iparapheur
    send-iparapheur:
        name-action: 'Transmettre au parapheur'
        name: 'Transmis au parapheur'
        rule:
            last-action:
                - preparation-send-iparapheur
                - send-signature-error
        action-class: StandardAction
        connecteur-type: signature
        connecteur-type-action: SignatureEnvoie
        connecteur-type-mapping:
            iparapheur_type: iparapheur_type
            iparapheur_sous_type: iparapheur_sous_type
            iparapheur_dossier_id: iparapheur_dossier_id
            json_metadata: json_metadata
            fast_parapheur_circuit: fast_parapheur_circuit
            fast_parapheur_circuit_configuration: fast_parapheur_circuit_configuration
            fast_parapheur_email_destinataire: fast_parapheur_email_destinataire
            fast_parapheur_email_cc: fast_parapheur_email_cc
            fast_parapheur_agents: fast_parapheur_agents
            send-signature-error: send-signature-error
            primo_signature_detachee: primo_signature_detachee
            iparapheur_annotation_publique: annotation_publique
            iparapheur_annotation_privee: annotation_privee
            iparapheur_has_date_limite: has_date_limite
            iparapheur_date_limite: date_limite
            objet: objet
            document: fichier_acte
            autre_document_attache: annexe
        action-automatique: verif-iparapheur
    send-signature-error:
        name: "Erreur lors de l'envoi du dossier à la signature"
        editable-content:
            - iparapheur_sous_type
            - json_metadata
            - has_date_limite
            - date_limite
            - fast_parapheur_circuit
            - fast_parapheur_circuit_configuration
            - fast_parapheur_email_destinataire
            - fast_parapheur_email_cc
            - fast_parapheur_agents
        rule:
            role_id_e: no-role
        modification-no-change-etat: true
    verif-iparapheur:
        name-action: 'Vérifier le statut de signature'
        name: 'Vérification de la signature'
        rule:
            last-action:
                - erreur-verif-iparapheur
                - send-iparapheur
        action-class: StandardAction
        connecteur-type: signature
        connecteur-type-action: SignatureRecuperation
        connecteur-type-mapping:
            iparapheur_historique: iparapheur_historique
            parapheur_last_message: parapheur_last_message
            parapheur_date_signature: parapheur_date_signature
            has_signature: has_signature
            signature: signature
            document_original: document_original
            multi_document_original: multi_document_original
            bordereau: bordereau_signature
            iparapheur_annexe_sortie: iparapheur_annexe_sortie
            iparapheur_dossier_id: iparapheur_dossier_id
            recu-iparapheur: recu-iparapheur
            rejet-iparapheur: rejet-iparapheur
            erreur-verif-iparapheur: erreur-verif-iparapheur
            iparapheur_has_date_limite: has_date_limite
            iparapheur_date_limite: date_limite
            objet: objet
            document: fichier_acte
            autre_document_attache: annexe
    erreur-verif-iparapheur:
        name: 'Erreur lors de la vérification du statut de signature'
        rule:
            role_id_e: no-role
    recu-iparapheur:
        name: 'Signature récupérée'
        rule:
            role_id_e: no-role
        action-automatique: orientation
        editable-content:
            - envoi_transformation_fixe
            - envoi_tdt_actes
            - envoi_depot
            - envoi_sae
            - acte_nature
            - numero_de_lacte
            - date_de_lacte
            - document_papier
            - classification
            - type_piece
            - type_acte
            - type_pj
            - acte_publication_date
            - sae_show
            - journal
            - date_journal_debut
            - date_cloture_journal
            - date_cloture_journal_iso8601
            - sae_transfert_id
            - sae_bordereau
            - sae_archive
            - ar_sae
            - sae_ack_comment
            - reply_sae
            - sae_archival_identifier
            - sae_atr_comment
        modification-no-change-etat: true
    rejet-iparapheur:
        name: 'Signature refusée'
        rule:
            role_id_e: no-role
    iparapheur-sous-type:
        name: 'Liste des sous-type iparapheur'
        no-workflow: true
        rule:
            role_id_e: no-role
        action-class: IparapheurSousType
        connecteur-type-mapping:
            iparapheur_type: iparapheur_type
            iparapheur_sous_type: iparapheur_sous_type
            fast_parapheur_circuit: fast_parapheur_circuit
    preparation-transformation-fixe:
        name: 'Préparation à la transformation fixe'
        rule:
            role_id_e: no-role
        action-automatique: transformation-fixe
    transformation-fixe:
        name: 'Transformation fixe du document'
        rule:
            last-action:
                - preparation-transformation-fixe
                - transformation-fixe-error
        action-class: StandardAction
        action-automatique: orientation
        connecteur-type: transformation
        connecteur-type-action: TransformationFixeTransform
        connecteur-type-mapping:
            transformation_fixe_file: transformation_fixe_file
            has_transformation_fixe: has_transformation_fixe
            transformation-fixe-error: transformation-fixe-error
        editable-content:
            - envoi_tdt_actes
            - envoi_depot
            - envoi_sae
            - acte_nature
            - numero_de_lacte
            - date_de_lacte
            - document_papier
            - classification
            - type_piece
            - type_acte
            - type_pj
            - acte_publication_date
            - sae_show
            - journal
            - date_journal_debut
            - date_cloture_journal
            - date_cloture_journal_iso8601
            - sae_transfert_id
            - sae_bordereau
            - sae_archive
            - ar_sae
            - sae_ack_comment
            - reply_sae
            - sae_archival_identifier
            - sae_atr_comment
        modification-no-change-etat: true
        transformations:
            date_de_lacte: '{{ parapheur_date_signature  ? parapheur_date_signature : date_de_lacte}}'
    transformation-fixe-error:
        name: 'Erreur lors de la transformation fixe du document'
        rule:
            role_id_e: no-role
    pre-send-tdt:
        name: "Préparation de l'envoi au Tdt"
        rule:
            role_id_e: no-role
        action-automatique: send-tdt
    send-tdt:
        name-action: 'Transmettre au TdT'
        name: 'Transmis au TdT'
        rule:
            last-action:
                - pre-send-tdt
                - send-tdt-erreur
        action-class: StandardAction
        connecteur-type: TdT
        connecteur-type-action: TdTEnvoiActe
        connecteur-type-mapping:
            acte_nature: acte_nature
            numero_de_lacte: numero_de_lacte
            date_de_lacte: date_de_lacte
            document_papier: document_papier
            classification: classification
            type_acte: type_acte
            type_pj: type_pj
            send-tdt-erreur: send-tdt-erreur
            document-transmis-tdt: document-transmis-tdt
            tedetis_transaction_id: tedetis_transaction_id
            arrete: fichier_acte
            autre_document_attache: annexe
            objet: objet
        action-automatique: verif-tdt
    send-tdt-erreur:
        name: "Erreur lors de l'envoi des données au TdT"
        rule:
            role_id_e: no-role
        editable-content:
            - numero_de_lacte
    document-transmis-tdt:
        name-action: 'Transmettre les documents au TdT'
        name: 'En attente du certificat RGS**'
        rule:
            role_id_e: no-role
    teletransmission-tdt:
        name-action: 'Ordonner la télétransmission au TdT'
        name: 'Tentative de télétransmission sur le TDT'
        rule:
            last-action:
                - teletransmission-tdt
                - document-transmis-tdt
        action-class: TdtTeletransmettre
        connecteur-type-mapping:
            tedetis_transaction_id: tedetis_transaction_id
            return-teletransmission-tdt: return-teletransmission-tdt
    return-teletransmission-tdt:
        name: 'Ordre de télétransmission envoyé sur le TDT'
        rule:
            last-action:
                - teletransmission-tdt
        action-class: TdtRetourTeletransmettre
        connecteur-type-mapping:
            tedetis_transaction_id: tedetis_transaction_id
        action-automatique: verif-tdt
    verif-tdt:
        name-action: 'Vérifier le statut de la transaction'
        name: 'Statut vérifié par le TdT'
        rule:
            last-action:
                - send-tdt
                - tdt-error
                - erreur-verif-tdt
                - document-transmis-tdt
                - teletransmission-tdt
                - return-teletransmission-tdt
        action-class: StandardAction
        connecteur-type: TdT
        connecteur-type-action: TdTRecupActe
        connecteur-type-mapping:
            tedetis_transaction_id: tedetis_transaction_id
            erreur-verif-tdt: erreur-verif-tdt
            acquiter-tdt: acquiter-tdt
            numero_de_lacte: numero_de_lacte
            has_bordereau: has_bordereau
            bordereau: bordereau
            aractes: aractes
            acte_tamponne: acte_tamponne
            annexes_tamponnees: annexes_tamponnees
            date_ar: date_ar
            arrete: fichier_acte
            autre_document_attache: annexe
            objet: objet
    erreur-verif-tdt:
        name: "Erreur lors de la vérification du statut de l'acte"
        rule:
            role_id_e: no-role
    tdt-error:
        name: 'Erreur sur le TdT'
        rule:
            role_id_e: no-role
    acquiter-tdt:
        name: 'Acquitté par la préfecture'
        rule:
            role_id_e: no-role
        action-automatique: orientation
        editable-content:
            - envoi_depot
            - envoi_sae
            - sae_show
            - journal
            - date_journal_debut
            - date_cloture_journal
            - date_cloture_journal_iso8601
            - sae_transfert_id
            - sae_bordereau
            - sae_archive
            - ar_sae
            - sae_ack_comment
            - reply_sae
            - sae_archival_identifier
            - sae_atr_comment
            - acte_publication_date
        modification-no-change-etat: true
    annulation-tdt:
        name-action: 'Annuler la transaction'
        name: "Demande d'annulation envoyée"
        rule:
            has-action:
                - acquiter-tdt
            no-action:
                - annulation-tdt
        action-class: StandardAction
        connecteur-type: TdT
        connecteur-type-action: TdTAnnulation
        connecteur-type-mapping:
            tedetis_transaction_id: tedetis_transaction_id
            tedetis_annulation_id: tedetis_annulation_id
            has_annulation: has_annulation
            annulation-tdt: annulation-tdt
            numero_de_lacte: numero_de_lacte
            aractes_annulation: aractes_annulation
        action-automatique: verif-annulation-tdt
        warning: "Attention cette action n'est pas réversible"
    tamponner-tdt:
        name: "Retamponner l'acte et les annexes"
        rule:
            has-action:
                - acquiter-tdt
        action-class: StandardAction
        connecteur-type: TdT
        connecteur-type-action: TdTRestamp
        connecteur-type-mapping:
            tedetis_transaction_id: tedetis_transaction_id
            acte_tamponne: acte_tamponne
            annexes_tamponnees: annexes_tamponnees
            date_ar: date_ar
            acte_publication_date: acte_publication_date
            arrete: fichier_acte
            autre_document_attache: annexe
            objet: objet
    verif-annulation-tdt:
        name-action: "Vérifier le statut de la transaction d'annulation"
        name: 'Statut vérifié par le TdT'
        rule:
            last-action:
                - annulation-tdt
        action-class: StandardAction
        connecteur-type: TdT
        connecteur-type-action: TdTRecupAnnulation
        connecteur-type-mapping:
            tedetis_transaction_id: tedetis_transaction_id
            tdt-error: tdt-error
            annuler-tdt: annuler-tdt
            date_ar_annulation: date_ar_annulation
    annuler-tdt:
        name: 'Transaction annulée'
        rule:
            role_id_e: no-role
    type-piece:
        name: 'Typologie des pièces'
        no-workflow: true
        rule:
            role_id_e: no-role
        action-class: StandardChoiceAction
        connecteur-type: TdT
        connecteur-type-action: TdtChoiceTypologieActes
        connecteur-type-mapping:
            acte_nature: acte_nature
            classification: classification
            arrete: fichier_acte
            autre_document_attache: annexe
    classification:
        name: 'Classification ACTES'
        no-workflow: true
        rule:
            role_id_e: no-role
        action-class: Classification
    autre_document_attache-change:
        no-workflow: true
        rule:
            role_id_e: no-role
        action-class: StandardAction
        connecteur-type: TdT
        connecteur-type-action: TdtAnnexeTypologieAnnexeChange
    typology-change-by-api:
        no-workflow: true
        rule:
            role_id_e: no-role
        action-class: StandardAction
        connecteur-type: TdT
        connecteur-type-action: TdtTypologieChangeByApi
        connecteur-type-mapping:
            type_acte: type_acte
            type_pj: type_pj
            type_piece: type_piece
            type_piece_fichier: type_piece_fichier
            acte_nature: acte_nature
            arrete: fichier_acte
            autre_document_attache: annexe
    preparation-send-ged:
        name: "Préparation de l'envoi à la GED"
        rule:
            role_id_e: no-role
        action-automatique: send-ged
    send-ged:
        name-action: 'Verser à la GED'
        name: 'Versé à la GED'
        rule:
            last-action:
                - preparation-send-ged
                - error-ged
        action-automatique: orientation
        action-class: StandardAction
        connecteur-type: GED
        connecteur-type-action: GEDEnvoyer
        connecteur-type-mapping:
            fatal-error: error-ged
        editable-content:
            - envoi_sae
            - sae_show
            - journal
            - date_journal_debut
            - date_cloture_journal
            - date_cloture_journal_iso8601
            - sae_transfert_id
            - sae_bordereau
            - sae_archive
            - ar_sae
            - sae_ack_comment
            - reply_sae
            - sae_archival_identifier
            - sae_atr_comment
            - acte_publication_date
        modification-no-change-etat: true
    error-ged:
        name: 'Erreur irrécupérable lors du dépôt'
        rule:
            role_id_e: no-role
    preparation-send-sae:
        name: "Préparation de l'envoi au SAE"
        rule:
            role_id_e: no-role
        action-automatique: generate-sip
    generate-sip:
        name-action: "Générer le paquet d'archive (SIP)"
        name: "Paquet d'archive (SIP) généré"
        rule:
            last-action:
                - preparation-send-sae
                - generate-sip-error
                - rejet-sae
                - erreur-envoie-sae
        action-class: StandardAction
        connecteur-type: SAE
        connecteur-type-action: Pastell\Step\SAE\Action\SAEGenerateArchiveAction
        action-automatique: send-archive
        connecteur-type-mapping:
            generate-sip-error: generate-sip-error
            sae_show: sae_show
            sae_bordereau: sae_bordereau
            sae_archive: sae_archive
            journal: journal
            date_journal_debut: date_journal_debut
            date_cloture_journal: date_cloture_journal
            date_cloture_journal_iso8601: date_cloture_journal_iso8601
    generate-sip-error:
        name: "Erreur lors de la génération de l'archive"
        rule:
            role_id_e: no-role
    send-archive:
        name-action: 'Verser au SAE'
        name: 'Versé au SAE'
        rule:
            last-action:
                - generate-sip
                - rejet-sae
                - erreur-envoie-sae
        action-class: StandardAction
        connecteur-type: SAE
        connecteur-type-action: Pastell\Step\SAE\Action\SAESendArchiveAction
        action-automatique: verif-sae
        connecteur-type-mapping:
            sae_transfert_id: sae_transfert_id
            sae_bordereau: sae_bordereau
            sae_archive: sae_archive
            erreur-envoie-sae: erreur-envoie-sae
    erreur-envoie-sae:
        name: "Erreur lors de l'envoi au SAE"
        rule:
            role_id_e: no-role
    verif-sae:
        name-action: "Récupérer l'AR du document sur le SAE"
        name: "Récuperation de l'AR sur le SAE"
        rule:
            last-action:
                - send-archive
                - verif-sae-erreur
        action-class: StandardAction
        connecteur-type: SAE
        connecteur-type-action: SAEVerifier
        connecteur-type-mapping:
            sae_transfert_id: sae_transfert_id
            ar_sae: ar_sae
            ar-recu-sae: ar-recu-sae
            verif-sae-erreur: verif-sae-erreur
            sae_ack_comment: sae_ack_comment
            sae_bordereau: sae_bordereau
            ack-not-provided: ack-not-provided
    verif-sae-erreur:
        name: "Erreur lors de la récupération de l'AR"
        rule:
            role_id_e: no-role
    ar-recu-sae:
        name: 'AR SAE reçu'
        rule:
            role_id_e: no-role
        action-automatique: validation-sae
    ack-not-provided:
        name: 'En attente de la validation par le SAE'
        rule:
            role_id_e: no-role
        action-automatique: validation-sae
    validation-sae:
        name-action: "Vérifier l'acceptation par le SAE"
        name: "Vérification de l'acceptation par le SAE"
        rule:
            last-action:
                - ar-recu-sae
                - ack-not-provided
                - validation-sae-erreur
        action-class: StandardAction
        connecteur-type: SAE
        connecteur-type-action: SAEValider
        connecteur-type-mapping:
            sae_transfert_id: sae_transfert_id
            reply_sae: reply_sae
            erreur-envoie-sae: erreur-envoie-sae
            validation-sae-erreur: validation-sae-erreur
            accepter-sae: accepter-sae
            rejet-sae: rejet-sae
            sae_atr_comment: sae_atr_comment
            sae_archival_identifier: sae_archival_identifier
            sae_bordereau: sae_bordereau
    validation-sae-erreur:
        name: 'Erreur lors de la vérification de la validité du transfert'
        rule:
            role_id_e: no-role
    accepter-sae:
        name: 'Transfert accepté par le SAE'
        rule:
            role_id_e: no-role
        action-automatique: orientation
        editable-content:
            - acte_publication_date
        modification-no-change-etat: true
    rejet-sae:
        name: 'Transfert rejeté par le SAE'
        rule:
            role_id_e: no-role
threshold_size: '157286400'
threshold_fields:
    - fichier_acte
    - annexe
studio_definition: ewogICJpZF90eXBlX2Rvc3NpZXIiOiAiZHJhZnQtbHMtYWN0ZXMiLAogICJwYXN0ZWxsLXZlcnNpb24iOiAiJVZFUlNJT04lIiwKICAidGltZXN0YW1wIjogMTcxNTg2MjU5NSwKICAicmF3X2RhdGEiOiB7CiAgICAiaWRfdHlwZV9kb3NzaWVyIjogImRyYWZ0LWxzLWFjdGVzIiwKICAgICJub20iOiAiQWN0ZXMgKERyYWZ0KSIsCiAgICAidHlwZSI6ICJBY3RlcyBhZG1pbmlzdHJhdGlmcyIsCiAgICAiZGVzY3JpcHRpb24iOiAiVHlwZSBkZSBkb3NzaWVyIHBlcm1ldHRhbnQgZCdlbnZveWVyIGRlcyBBY3RlcyBlbiBzaWduYXR1cmUsIFREVCwgR0VELCBTQUUiLAogICAgIm5vbV9vbmdsZXQiOiAiSW5mb3JtYXRpb25zIiwKICAgICJhZmZpY2hlX29uZSI6IGZhbHNlLAogICAgInJlc3RyaWN0aW9uX3BhY2siOiAiIiwKICAgICJmb3JtdWxhaXJlRWxlbWVudCI6IFsKICAgICAgewogICAgICAgICJlbGVtZW50X2lkIjogIm9iamV0IiwKICAgICAgICAibmFtZSI6ICJPYmpldCIsCiAgICAgICAgInR5cGUiOiAidGV4dGFyZWEiLAogICAgICAgICJjb21tZW50YWlyZSI6ICJFbnRyZSAxIGV0IDQ5OSBjYXJhY3RcdTAwZThyZXMiLAogICAgICAgICJyZXF1aXMiOiAib24iLAogICAgICAgICJjaGFtcHNfYWZmaWNoZXMiOiAiIiwKICAgICAgICAiY2hhbXBzX3JlY2hlcmNoZV9hdmFuY2VlIjogIiIsCiAgICAgICAgInRpdHJlIjogIm9uIiwKICAgICAgICAic2VsZWN0X3ZhbHVlIjogIiIsCiAgICAgICAgInByZWdfbWF0Y2giOiAiI14uezEsNDk5fSQjdXMiLAogICAgICAgICJkZWZhdWx0X3ZhbHVlIjogIiIsCiAgICAgICAgInByZWdfbWF0Y2hfZXJyb3IiOiAiZW50cmUgMSBldCA0OTkgY2FyYWN0XHUwMGU4cmVzIiwKICAgICAgICAiY29udGVudF90eXBlIjogIiIKICAgICAgfSwKICAgICAgewogICAgICAgICJlbGVtZW50X2lkIjogImZpY2hpZXJfYWN0ZSIsCiAgICAgICAgIm5hbWUiOiAiRmljaGllciBBY3RlIiwKICAgICAgICAidHlwZSI6ICJmaWxlIiwKICAgICAgICAiY29tbWVudGFpcmUiOiAiRm9ybWF0IFBERiBvdSBYTUwiLAogICAgICAgICJyZXF1aXMiOiAib24iLAogICAgICAgICJjaGFtcHNfYWZmaWNoZXMiOiAiIiwKICAgICAgICAiY2hhbXBzX3JlY2hlcmNoZV9hdmFuY2VlIjogIiIsCiAgICAgICAgInRpdHJlIjogIiIsCiAgICAgICAgInNlbGVjdF92YWx1ZSI6ICIiLAogICAgICAgICJwcmVnX21hdGNoIjogIiIsCiAgICAgICAgImRlZmF1bHRfdmFsdWUiOiAiIiwKICAgICAgICAicHJlZ19tYXRjaF9lcnJvciI6ICIiLAogICAgICAgICJjb250ZW50X3R5cGUiOiAiYXBwbGljYXRpb25cL3BkZiwgYXBwbGljYXRpb25cL3htbCIKICAgICAgfSwKICAgICAgewogICAgICAgICJlbGVtZW50X2lkIjogImFubmV4ZSIsCiAgICAgICAgIm5hbWUiOiAiQW5uZXhlKHMpIiwKICAgICAgICAidHlwZSI6ICJtdWx0aV9maWxlIiwKICAgICAgICAiY29tbWVudGFpcmUiOiAiQXR0ZW50aW9uICEgTGEgdGFpbGxlIHRvdGFsZSBkZXMgZG9jdW1lbnRzIGFjdGUgKyBhbm5leGVzIG5lIHBldXQgcGFzIGRcdTAwZTlwYXNzZXIgMTUwIE1vIiwKICAgICAgICAicmVxdWlzIjogIiIsCiAgICAgICAgImNoYW1wc19hZmZpY2hlcyI6ICIiLAogICAgICAgICJjaGFtcHNfcmVjaGVyY2hlX2F2YW5jZWUiOiAiIiwKICAgICAgICAidGl0cmUiOiAiIiwKICAgICAgICAic2VsZWN0X3ZhbHVlIjogIiIsCiAgICAgICAgInByZWdfbWF0Y2giOiAiIiwKICAgICAgICAiZGVmYXVsdF92YWx1ZSI6ICIiLAogICAgICAgICJwcmVnX21hdGNoX2Vycm9yIjogIiIsCiAgICAgICAgImNvbnRlbnRfdHlwZSI6ICIiCiAgICAgIH0sCiAgICAgIHsKICAgICAgICAiZWxlbWVudF9pZCI6ICJtZXRhZG9ubmVlcyIsCiAgICAgICAgIm5hbWUiOiAiRmljaGllciBjb250ZW5hbnQgbGVzIG1cdTAwZTl0YWRvbm5cdTAwZTllcyIsCiAgICAgICAgInR5cGUiOiAiZmlsZSIsCiAgICAgICAgImNvbW1lbnRhaXJlIjogIlByXHUwMGU5Zlx1MDBlOXJlbnRpZWxsZW1lbnQgYXUgZm9ybWF0IEpTT04sIFhNTCBwb3NzaWJsZSIsCiAgICAgICAgInJlcXVpcyI6ICIiLAogICAgICAgICJjaGFtcHNfYWZmaWNoZXMiOiAiIiwKICAgICAgICAiY2hhbXBzX3JlY2hlcmNoZV9hdmFuY2VlIjogIiIsCiAgICAgICAgInRpdHJlIjogIiIsCiAgICAgICAgInNlbGVjdF92YWx1ZSI6ICIiLAogICAgICAgICJwcmVnX21hdGNoIjogIiIsCiAgICAgICAgImRlZmF1bHRfdmFsdWUiOiAiIiwKICAgICAgICAicHJlZ19tYXRjaF9lcnJvciI6ICIiLAogICAgICAgICJjb250ZW50X3R5cGUiOiAiIgogICAgICB9CiAgICBdLAogICAgImV0YXBlIjogWwogICAgICB7CiAgICAgICAgIm51bV9ldGFwZSI6IDAsCiAgICAgICAgInR5cGUiOiAidHJhbnNmb3JtYXRpb24iLAogICAgICAgICJsYWJlbCI6ICJUcmFuc2Zvcm1hdGlvbiIsCiAgICAgICAgImRlZmF1bHRDaGVja2VkIjogZmFsc2UsCiAgICAgICAgInJlcXVpcyI6ICJvbiIsCiAgICAgICAgImF1dG9tYXRpcXVlIjogIm9uIiwKICAgICAgICAic3BlY2lmaWNfdHlwZV9pbmZvIjogW10sCiAgICAgICAgIm51bV9ldGFwZV9zYW1lX3R5cGUiOiAwLAogICAgICAgICJldGFwZV93aXRoX3NhbWVfdHlwZV9leGlzdHMiOiBmYWxzZQogICAgICB9LAogICAgICB7CiAgICAgICAgIm51bV9ldGFwZSI6ICIxIiwKICAgICAgICAidHlwZSI6ICJzaWduYXR1cmUiLAogICAgICAgICJsYWJlbCI6ICJTaWduYXR1cmUiLAogICAgICAgICJkZWZhdWx0Q2hlY2tlZCI6IGZhbHNlLAogICAgICAgICJyZXF1aXMiOiAiIiwKICAgICAgICAiYXV0b21hdGlxdWUiOiAib24iLAogICAgICAgICJzcGVjaWZpY190eXBlX2luZm8iOiB7CiAgICAgICAgICAibGliZWxsZV9wYXJhcGhldXIiOiAib2JqZXQiLAogICAgICAgICAgImRvY3VtZW50X2Ffc2lnbmVyIjogImZpY2hpZXJfYWN0ZSIsCiAgICAgICAgICAiYW5uZXhlIjogImFubmV4ZSIsCiAgICAgICAgICAiaGFzX2RhdGVfbGltaXRlIjogIm9uIiwKICAgICAgICAgICJoYXNfcHJpbW9fc2lnbmF0dXJlIjogIm9uIiwKICAgICAgICAgICJoYXNfbWV0YWRhdGFfaW5fanNvbiI6ICJvbiIsCiAgICAgICAgICAiY29udGludWVfYWZ0ZXJfcmVmdXNhbCI6ICIiCiAgICAgICAgfSwKICAgICAgICAibnVtX2V0YXBlX3NhbWVfdHlwZSI6IDAsCiAgICAgICAgImV0YXBlX3dpdGhfc2FtZV90eXBlX2V4aXN0cyI6IGZhbHNlCiAgICAgIH0sCiAgICAgIHsKICAgICAgICAibnVtX2V0YXBlIjogIjIiLAogICAgICAgICJ0eXBlIjogInRyYW5zZm9ybWF0aW9uX2ZpeGUiLAogICAgICAgICJsYWJlbCI6ICJUcmFuc2Zvcm1hdGlvbiBGaXhlIChkYXRlKSIsCiAgICAgICAgImRlZmF1bHRDaGVja2VkIjogZmFsc2UsCiAgICAgICAgInJlcXVpcyI6ICJvbiIsCiAgICAgICAgImF1dG9tYXRpcXVlIjogIm9uIiwKICAgICAgICAic3BlY2lmaWNfdHlwZV9pbmZvIjogewogICAgICAgICAgInRyYW5zZm9ybWF0aW9ucyI6ICJkYXRlX2RlX2xhY3RlOnt7IHBhcmFwaGV1cl9kYXRlX3NpZ25hdHVyZSAgPyBwYXJhcGhldXJfZGF0ZV9zaWduYXR1cmUgOiBkYXRlX2RlX2xhY3RlfX0iCiAgICAgICAgfSwKICAgICAgICAibnVtX2V0YXBlX3NhbWVfdHlwZSI6IDAsCiAgICAgICAgImV0YXBlX3dpdGhfc2FtZV90eXBlX2V4aXN0cyI6IGZhbHNlCiAgICAgIH0sCiAgICAgIHsKICAgICAgICAibnVtX2V0YXBlIjogIjMiLAogICAgICAgICJ0eXBlIjogInRkdF9hY3RlcyIsCiAgICAgICAgImxhYmVsIjogIlByXHUwMGU5ZmVjdHVyZSAodmlhIFRkdCkiLAogICAgICAgICJkZWZhdWx0Q2hlY2tlZCI6IGZhbHNlLAogICAgICAgICJyZXF1aXMiOiAiIiwKICAgICAgICAiYXV0b21hdGlxdWUiOiAib24iLAogICAgICAgICJzcGVjaWZpY190eXBlX2luZm8iOiB7CiAgICAgICAgICAib2JqZXRfYWN0ZSI6ICJvYmpldCIsCiAgICAgICAgICAiZmljaGllcl9hY3RlIjogImZpY2hpZXJfYWN0ZSIsCiAgICAgICAgICAiZmljaGllcl9hbm5leGUiOiAiYW5uZXhlIiwKICAgICAgICAgICJkcm9pdF9zcGVjaWZpcXVlIjogIiIKICAgICAgICB9LAogICAgICAgICJudW1fZXRhcGVfc2FtZV90eXBlIjogMCwKICAgICAgICAiZXRhcGVfd2l0aF9zYW1lX3R5cGVfZXhpc3RzIjogZmFsc2UKICAgICAgfSwKICAgICAgewogICAgICAgICJudW1fZXRhcGUiOiA0LAogICAgICAgICJ0eXBlIjogImRlcG90IiwKICAgICAgICAibGFiZWwiOiAiIiwKICAgICAgICAiZGVmYXVsdENoZWNrZWQiOiBmYWxzZSwKICAgICAgICAicmVxdWlzIjogIiIsCiAgICAgICAgImF1dG9tYXRpcXVlIjogIm9uIiwKICAgICAgICAic3BlY2lmaWNfdHlwZV9pbmZvIjogW10sCiAgICAgICAgIm51bV9ldGFwZV9zYW1lX3R5cGUiOiAwLAogICAgICAgICJldGFwZV93aXRoX3NhbWVfdHlwZV9leGlzdHMiOiBmYWxzZQogICAgICB9LAogICAgICB7CiAgICAgICAgIm51bV9ldGFwZSI6ICI1IiwKICAgICAgICAidHlwZSI6ICJzYWUiLAogICAgICAgICJsYWJlbCI6IG51bGwsCiAgICAgICAgImRlZmF1bHRDaGVja2VkIjogZmFsc2UsCiAgICAgICAgInJlcXVpcyI6ICIiLAogICAgICAgICJhdXRvbWF0aXF1ZSI6ICJvbiIsCiAgICAgICAgInNwZWNpZmljX3R5cGVfaW5mbyI6IHsKICAgICAgICAgICJzYWVfaGFzX21ldGFkYXRhX2luX2pzb24iOiAiIgogICAgICAgIH0sCiAgICAgICAgIm51bV9ldGFwZV9zYW1lX3R5cGUiOiAwLAogICAgICAgICJldGFwZV93aXRoX3NhbWVfdHlwZV9leGlzdHMiOiBmYWxzZQogICAgICB9CiAgICBdCiAgfQp9
