nom: E-mégalis
type: Flux Généraux

connecteur:
	SAE
	
formulaire:
	Archive:
		archive: {name: Archive d'origine, type: file, title: true}
		empreinte: {name: Empreinte de l'archive d'origine}
		transfert_id: {name: Identifiant du transfert} 
		bordereau: {name: Bordereau, type: file}
		fichier_attache: {name: Archive, type: file} 
		ar_sae: {type: file, name: Accusé de réception SAE}
		reply_sae: {type: file, name: Réponse du SAE}
		url_archive: {name: URL sur le système d'archive, type: url}
		
action:

	creation:		
		name-action: Créer
		name: Créé		
		rule:
			role_id_e: no-role	

	recuperation:
		name: Récupéré
		name-action: Récupérer		
		rule:
			role_id_e: no-role		
		action-automatique: send-archive	
		
	recuperation-erreur:
		name: Erreur lors de la récupération
		rule:
			role_id_e: no-role
	
	send-archive:
		name-action: Verser au SAE
		name: Versé au SAE
	
		rule:
			last-action:
				erreur-envoie-sae
				recuperation
			no-action:
				send-archive	
			droit_id_u: 'megalis:edition'
		action-class: SAEEnvoiMegalis
		action-automatique: verif-sae

	erreur-envoie-sae:
		name: Erreur lors de l'envoi au SAE
		rule:
			role_id_e: no-role

	verif-sae:
		name-action: Récupérer l'AR du document sur le SAE
		name: Récuperation de l'AR sur le SAE
		rule:
			last-action:
				send-archive
				verif-sae-erreur
			droit_id_u: 'megalis:edition'
		action-class: SAEVerifMegalis

	verif-sae-erreur:
		name: Erreur lors de la récupération de l'AR
		rule:
			role_id_e: no-role		
			
	ar-recu-sae:
		name: AR SAE reçu
		rule:
			role_id_e: no-role
		action-automatique: validation-sae
	
	validation-sae:
		name-action: Vérifier l'acceptation par le SAE
		name: Vérification de l'acceptation par le SAE
		rule:
			last-action:
				ar-recu-sae
				validation-sae-erreur
			droit_id_u: 'megalis:edition'
		action-class: SAEValidationMegalis
		
	validation-sae-erreur:
		name: Erreur lors de la vérification de la validité du transfert
		rule:
			role_id_e: no-role	
		
	accepter-sae:
		name: Archive accepté par le SAE
		rule:
			role_id_e: no-role
		action-automatique: supprimer-distant
			
	rejet-sae:
		name: Archive rejeter par le SAE
		rule: 
			role_id_e: no-role
			
	supprimer-distant:
		name: Suppresion du fichier sur le serveur Megalis
		name-action: Supprimer le fichier sur le serveur Megalis
		rule:
			last-action:
				accepter-sae
				erreur-supprimer-distant
			droit_id_u: 'megalis:edition'
		action-class: MegalisSupprime
			
	erreur-supprimer-distant:
		name: Erreur lors de la suppression
		rule:
			role_id_e: no-role
	
	termine:
		name: Integration SAE ok
		rule: 
			role_id_e: no-role
	
	supression:
		name-action: Supprimer
		name: Supprimé
		
		rule:
			last-action: 
				creation
				recuperation-erreur
				accepter-sae
				rejet-sae
				erreur-envoie-sae
				recuperation
				verif-sae-erreur
				validation-sae-erreur
				termine
				erreur-supprimer-distant
			role_id_e: editeur
			droit_id_u: 'megalis:edition'
		action-class: Supprimer
		warning: "Êtes-vous sûr ?"
	