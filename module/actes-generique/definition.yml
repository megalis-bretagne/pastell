nom: Actes (générique)

type: Flux Généraux

description: |
	Le flux « Actes (générique) » permet de créer des actes et de les envoyer à un ou plusieurs des connecteurs suivant : signature, TdT, SAE et GED. 
	
	Le cheminement est le suivant : signature -> TdT -> SAE -> GED. Chacune de ces étapes est facultatives.
	
	Ce flux peut servir de base à tous les flux utilisant des actes.

connecteur:
	SAE
	TdT
	signature
	GED
	Bordereau SEDA
	

formulaire:
	Acte:
		acte_nature:
			name: Nature de l'acte
			type: select
			requis: true
			value: 
				3: Arrêtés Individuels
				2: Arrêtés réglementaires
				6: Autres
				4: Contrats et conventions
				1: Délibérations
				5: Documents budgétaires et financiers
	
		Numéro de l'acte:
			requis: true
			commentaire: "15 caractères maxi, chiffres, lettres en majuscule ou _"
			preg_match: "#^[0-9A-Z_]{1,15}$#"
			preg_match_error: "15 caractères maxi, chiffres, lettres en majuscule ou _"
				
		Objet: {requis: true, title: true}
		Date de l'acte: {type: date, requis: true, commentaire: date de la décision}
		Arreté: {name: Acte, type: file, requis: true, commentaire: "format PDF ou XML"}
		Autre document attaché: {type: file, multiple: true, commentaire: "Attention ! La taille totale des documents acte + annexes ne peut pas dépasser 20 Mo."}
		
	Cheminement:
		classification:
			name: Classification Actes
			type: externalData
			link_name: liste des matières et sous-matières
			choice-action: classification
		
		envoi_signature:
			name: Transmission au parapheur
			type: checkbox
			onchange: envoi-signature-change
			
		envoi_tdt: 
			name: Transmission au contrôle de légalité 
			type: checkbox
			onchange: envoi-sae-change
		
		envoi_ged:
			name: Transmission à la GED
			type: checkbox
		
		envoi_sae:
			name: Transmission au SAE
			type: checkbox
			onchange: envoi-sae-change
	
	Parapheur:
		iparapheur_type: 
			name: Type iParapheur
			read-only: true
			
		iparapheur_sous_type:
			name: Sous Type iParapheur
			requis: true
			read-only: true
			type: externalData
			choice-action: iparapheur-sous-type
			link_name: liste des types
		
	Signature:
		has_signature: {no-show: true}
		signature: {name: Signature de l'acte, type: file}
		document_signe: {name: Bordereau de signature, type: file}
		
	Informations complémentaires:
		has_information_complementaire: 
			no-show: true
			read-only: true
		signature: {name: Signature de l'acte, type: file}
		document_signe: {name: Bordereau de signature, type: file}
		bordereau: 
			name: Bordereau d'acquittement
			type: file
			
		aractes: 
			name: Accusé de réception technique
			type: file
			requis: true
			commentaire: Accusé de réception (XML) envoyé par la préfecture
			
		echange_prefecture:
			name: Documents échangés avec la préfecture
			commentaire: faire suivre les échanges aller par les échanges retours, faire suivre l'échange retour principal par les annexes
			type: file
			multiple: true
			
		echange_prefecture_ar:
			name: Accusé de réception des documents échangés
			commentaire: l'ordre des accusés de réception doit correspondre à celle des documents échangés. 
			type: file
			multiple: true
		
		echange_prefecture_type:
			name: Type de l'échange
			type: select
			depend: echange_prefecture
			value: 
				2A: Courrier simple
				3A: Demande de pièces complémentaires
				4A: Lettre d'observations
				5A: Déféré au tribunal administratif
				2R: Réponse à un courrier simple
				3R: Réponse à une demande de pièces complémentaires
				3RB: Annexe d'une réponse à une demande de pièce complémentaires
				4R: Réponse à une lettre d'observations 
			
		
	Bordereau:
		has_bordereau: 
			no-show: true
			read-only: true
			
		bordereau: 
			name: Bordereau d'acquittement
			type: file
			
		aractes: 
			name: Accusé de réception technique
			type: file
			commentaire: Accusé de réception (XML) envoyé par la préfecture
		
		acte_tamponne:
			name: Acte tamponné par le TdT
			type: file
			
	SAE:
		sae_transfert_id:
			name: Identifiant du transfert
		ar_sae: {type: file, name: Accusé de réception SAE}
		reply_sae: {type: file, name: Réponse du SAE}
		url_archive: {name: URL sur le système d'archive, type: url}
	
	Courrier Simple:
		has_courrier_simple:
			no-show: true
		courrier_simple:
			name: Courrier simple
			type: file
			read-only: true
		courrier_simple_id:
			no-show: true
		courrier_simple_date:
			name: Date de réception du courrier simple 
			type: date
			
	Demande de pièces complementaires:
		has_demande_piece_complementaire:
			no-show: true
		demande_piece_complementaire:
			name: Demande de pièces complémentaires
			type: file
			read-only: true
		
		demande_piece_complementaire_id:
			no-show: true
		demande_piece_complementaire_date:
			name: Date de réception de la demande de pièces complémentaires
			type: date
		has_demande_piece_complementaire:
			no-show: true
		has_reponse_demande_piece_complementaire:
			no-show: true
		reponse_demande_piece_complementaire:
			name: Première pièce complémentaire 
			requis: true
			type:file
			read-only-content:
				has_reponse_demande_piece_complementaire: true
		reponse_pj_demande_piece_complementaire:
			name: Autres pièces complémentaire
			type:file
			multiple: true
			read-only-content:
				has_reponse_demande_piece_complementaire: true
				
		nature_reponse_demande_piece_complementaire:
			name: Nature de la réponse
			requis: true
			type: select
			value: 
				3: Refus de réponse
				4: Réponse
			read-only-content:
				has_reponse_demande_piece_complementaire: true
		demande_piece_complementaire_has_acquittement:
			name: Aquittement de la réponse à la demande de pièce complémentaire reçu 
			type: checkbox	
		
	Lettre d'observation:
		has_lettre_observation:
			no-show: true
		lettre_observation:
			name: Lettre d'observation
			type: file
			read-only: true
		lettre_observation_id:
			no-show: true
		lettre_observation_date:
			name: Date de réception de la lettre d'observation
			type: date
		has_reponse_lettre_observation:
			no-show: true
		reponse_lettre_observation:
			name: Réponse à la lettre d'observation
			requis: true
			type:file
			read-only-content:
				has_reponse_lettre_observation: true
				
		nature_reponse_lettre_observation:
			name: Nature de la réponse
			requis: true
			type: select
			value: 
				3: Refus de réponse
				4: Réponse
			read-only-content:
				has_reponse_lettre_observation: true
				
		lettre_observation_has_acquittement:
			name: Aquittement de la réponse à la demande de pièce complémentaire reçu 
			type: checkbox	
	
	Déféré au tribunal administratif:
		has_defere_tribunal_administratif:
			no-show: true
		defere_tribunal_administratif:
			name: Déféré au tribunal administratif
			type: file
			read-only: true
		defere_tribunal_administratif_id:
			no-show: true
		defere_tribunal_administratif_date:
			name: Date du déféré au TA
			type: date
	
	Annulation:
		has_annulation:
			no-show: true
		tedetis_annulation_id:
			name: Identifiant de la transaction d'annulation

			

page-condition:
	Parapheur:
		envoi_signature: true
	
	Signature:
		has_signature: true
		
	Informations complémentaires:
		has_information_complementaire: true
		
	Bordereau:
		has_bordereau: true
	SAE:
		ar_sae: true
	
	Courrier Simple:
		has_courrier_simple: true
	
	Demande de pièces complementaires:
		has_demande_piece_complementaire: true
	
	Lettre d'observation:
		has_lettre_observation: true
		
	Déféré au tribunal administratif:
		has_defere_tribunal_administratif: true
	
	Annulation:
		has_annulation: true


action:

	creation:		
		name-action: Créer
		name: Créé
		
		rule:
			no-last-action:
			droit_id_u: 'actes-generique:edition'
			type_id_e: 
				service
				collectivite
		
	modification:	
		name-action: Modifier
		name: En cours de rédaction
		
		rule:
			last-action: 
				creation
				modification
				recu-iparapheur
				attente-reponse-prefecture
			role_id_e: editeur
			droit_id_u: 'actes-generique:edition'

	supression:
		name-action: Supprimer
		name: Supprimé
		
		rule:
			or_1:
				and_1:
					last-action: 
						creation
						modification
						recu-iparapheur
						rejet-iparapheur
				
					no-action:
					send-tdt
				and_2:
					last-action:
						accepter-sae
						rejeter-sae
				and_3:
					last-action:
						send-ged
					content:
						envoie_sae: false
				and_4:
					last-action:
						acquiter-tdt
						erreur-verif-tdt
					content:
						envoie_sae: false
						envoie_ged: false
				and_5:
					last-action:
						termine
					
			role_id_e: editeur
			droit_id_u: 'actes-generique:edition'
		action-class: Supprimer
		warning: "Êtes-vous sûr ?"
	
	send-iparapheur:
		name-action: Transmettre au parapheur
		name: Transmis au parapheur
		
		rule:
			last-action: 
				creation
				modification
			no-action: 
				recu-iparapheur
			document_is_valide: true
			content:
				envoi_signature: true
				classification: true				
		action-class: IParapheurEnvoie
		action-automatique: verif-iparapheur
								 	
	verif-iparapheur:
		name-action: Vérifier le statut de signature
		name: Signature vérifiée
		rule:
			last-action:
				send-iparapheur
				erreur-verif-iparapheur
			role_id_e: editeur
			droit_id_u: 'actes-generique:edition'
		
		action-class: IParapheurRecup
			
			
	recu-iparapheur:
		name: Signature récuperée
		editable-content:
			classification
		rule:
			role_id_e: no-role
	
	rejet-iparapheur:
		name: Signature refusée
		rule: 
			role_id_e: no-role
	
	erreur-verif-iparapheur:
		name: Erreur lors de la vérification du statut de signature
		rule:
			role_id_e: no-role
	
	send-tdt:
		name-action: Transmettre à la préfecture
		name: Transmis en préfecture 
		
		rule:
			role_id_e: editeur
			droit_id_u: 'actes-generique:edition'
			document_is_valide: true
			or_1:
				and_1:
					last-action: 
						creation
						modification
					no-action: 
						send-tdt
					content: 
						envoi_tdt: true
						envoi_signature: false
				and_2:
					has-action: 
						recu-iparapheur
					no-action: 
						send-tdt
					content: 
						envoi_tdt: true
						envoi_signature: true
						
		action-class: TedetisEnvoie
		action-automatique: verif-tdt
	
	verif-tdt:
		name-action: Vérifier le statut de la transaction
		name: Statut vérifié par le TdT		
		rule:
			last-action:
				send-tdt
				erreur-verif-tdt
			role_id_e: editeur
			droit_id_u: 'actes-generique:edition'
		action-class: TedetisRecup
	
	erreur-verif-tdt:
		name: Erreur lors de la vérification du statut de l'acte
		rule:
			role_id_e: no-role
	
	acquiter-tdt:
		name: Acquitté par la préfecture 
		rule:
			role_id_e: no-role
	
	verif-reponse-tdt:
		name-action: Vérifier s'il y a des réponses de la préfecture
		name: Message de la préfecture récupéré
		rule:
			has-action:
				acquiter-tdt
			
			role_id_e: editeur
			droit_id_u: 'actes-generique:edition'
		action-class: TedetisVerifReponsePref
			
	attente-reponse-prefecture:
		name: Réponse à la préfecture attendue
		rule:
			role_id_e: no-role
		editable-content:
			reponse_lettre_observation
			nature_reponse_lettre_observation
			nature_reponse_demande_piece_complementaire
			reponse_demande_piece_complementaire
			reponse_pj_demande_piece_complementaire
	
	send-reponse-prefecture:
		name: Envoi de la réponse à la préfecture
		name-action: Envoyer la réponse à la préfecture
		rule:
			has-action: 
				attente-reponse-prefecture
			droit_id_u: 'actes-generique:edition'
			document_is_valide: true
			or_1:
				and_1:
					content:
						has_reponse_lettre_observation: false
						has_lettre_observation: true
				and_2:
					content:
						has_demande_piece_complementaire: true
						has_reponse_demande_piece_complementaire: false
		action-class: TedetisSendReponsePref	
	
	
	termine:
		name: Traitement terminé
		rule:
			role_id_e: no-role
	
	annulation-tdt:
		name-action: Annuler la transaction
		name: Demande d'annulation envoyée
		
		rule:
			has-action:
				acquiter-tdt
			no-action:
				annulation-tdt
			role_id_e: editeur
			droit_id_u: 'actes-generique:edition'
		action-class: TedetisAnnulation
		warning: Attention cette action n'est pas réversible

	verif-annulation-tdt:
		name-action: Vérifier le statut de la transaction d'annulation
		name: Statut vérifié par le TdT		
		rule:
			last-action:
				annulation-tdt
			role_id_e: editeur
			droit_id_u: 'actes-generique:edition'
		action-class: TedetisRecupAnnulation
			
	annuler-tdt:
		name: Transaction annulée
		rule:
			role_id_e: no-role
	
	send-ged:
		name-action: Verser à la GED
		name: Versé à la GED
		rule:
			content:
				envoi_ged: true
			or_1:
				and_1:
					last-action: 
						creation
						modification
					document_is_valide: true
					content:
						envoi_signature: false
						envoi_tdt: false
				and_2:
					last-action: 
						recu-iparapheur
					content:
						envoi_tdt: false
				and_3:
					last-action: 
						acquiter-tdt
						info-tdt					
		action-class: GEDEnvoi
	
	send-archive:
		name-action: Verser au SAE
		name: Versé au SAE
		rule:
			content:
				envoi_sae: true
			or_1:
				and_1:
					last-action: 
						creation
						modification
					document_is_valide: true
					content:
						envoi_signature: false
						envoi_tdt: false
						envoi_ged: false
				and_2:
					last-action: 
						recu-iparapheur
					content:
						envoi_tdt: false
						envoi_ged: false
				and_3:
					last-action: 
						acquiter-tdt
						info-tdt
					content:
						envoi_ged: false
				and_4:
					last-action:
						send-ged
				and_5:
					last-action:
						erreur-envoie-sae
		action-class: SAEEnvoiActes
		action-automatique: verif-sae

	erreur-envoie-sae:
		name: Erreur lors de l'envoi au SAE
		rule:
			role_id_e: no-role

	verif-sae:
		name-action: Récupérer l'AR du document sur le SAE
		name: Récuperation de l'AR sur le SAE
		rule:
			last-action:
				send-archive
				verif-sae-erreur
			droit_id_u: 'actes-generique:edition'
		action-class: SAEVerif

	verif-sae-erreur:
		name: Erreur lors de la récupération de l'AR
		rule:
			role_id_e: no-role		
			
	ar-recu-sae:
		name: AR SAE reçu
		rule:
			role_id_e: no-role
		action-automatique: validation-sae
	
	validation-sae:
		name-action: Vérifier l'acceptation par le SAE
		name: Vérification de l'acceptation par le SAE
		rule:
			last-action:
				ar-recu-sae
				validation-sae-erreur
			droit_id_u: 'actes-generique:edition'
		action-class: SAEValidation
		
	validation-sae-erreur:
		name: Erreur lors de la vérification de la validité du transfert
		rule:
			role_id_e: no-role	
		
	accepter-sae:
		name: Archive accepté par le SAE
		rule:
			role_id_e: no-role
			
	rejet-sae:
		name: Archive rejeter par le SAE
		rule: 
			role_id_e: no-role
			

	
	
	
	envoi-signature-change:		
		name: Modification envoi-signature
		no-workflow: true
		rule:
			role_id_e: no-role	
		action-class: EnvoieSignatureChange
	
	envoi-sae-change:
		name: Modification envoi_sae
		no-workflow: true
		rule: 
			role_id_e: no-role
		action-class: EnvoieSAEChange
			
	
	iparapheur-sous-type:
		name: Liste des sous-type iParapheur
		no-workflow: true
		rule: 
			role_id_e: no-role
		action-class: IparapheurSousType
	
	classification: 
		name: Classification ACTES
		no-workflow: true
		rule:
			role_id_e: no-role
		action-class: Classification
					
			
			