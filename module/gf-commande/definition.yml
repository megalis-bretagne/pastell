nom: Commande
type: Flux Financier

connecteur:
	signature
	GED


formulaire:
	Devis:
		Objet: {requis: true, title: true}
		Message: {type: textarea}
		Devis: {type: file, requis: true}
	
	Bon de commande :
		has_bon_de_commande: {no-show: true}
		message_commande: 
			name: Message
			type: textarea
			
		bon_de_commande:
			requis: true
			name: Bon de commande
			type: file
			
		iparapheur_type: 
			name: Type iParapheur
			read-only: true
			default: COMMANDE
			show-role: 
				lecteur
		sous_type_parapheur: 
			name: Sous-type iParapheur
			read-only: true
			default: bdc
			show-role: 
				lecteur
			
	Signature bon de commande:
		bon_de_commande_has_signature: 
			no-show: true

		signature_bon_de_commande: 
			name: Signature du bon de commande
			type: file
			
		bon_de_commande_signe: 
			name: Bordereau de signature
			type: file
	
	Facture:
		has_facture: 
			no-show: true
		message_facture: 
			name: Message
			type: textarea
			
		facture:
			requis: true
			name: Facture
			type: file
			
		iparapheur_type_facture: 
			name: Type iParapheur
			read-only: true
			default: COMMANDE
			show-role: 
				lecteur
				
		sous_type_parapheur_facture: 
			name: Sous-type iParapheur
			read-only: true
			default: facture
			show-role: 
				lecteur
					
	Signature facture:
		facture_has_signature: 
			no-show: true
		signature_facture:
			name: Signature de la facture
			type: file			
		facture_signe: 
			name: Bordereau de signature
			type: file
			
page-condition:
	Bon de commande:
		has_bon_de_commande: true
	Signature bon de commande:
		bon_de_commande_has_signature: true
	Facture:
		has_facture: true	
	Signature facture:
		facture_has_signature : true

action:
	creation:
		name-action: Créer
		name: Créé
		
		rule:
			no-last-action:
			droit_id_u: 'gf-commande:edition'
			type_id_e:
				fournisseur

	modification:	
		name-action: Modifier
		name: Modifié		
		rule:
			last-action: 
				creation
				modification
				
			role_id_e: editeur
			droit_id_u: 'gf-commande:edition'
	
	envoi :
		name-action: Envoyer
		name: Envoyé
		rule:
			last-action: 
				creation
				modification
			role_id_e: editeur
			droit_id_u: 'gf-commande:edition'
		action-class: Envoyer
		action-selection: collectivite
		
	recu:
		name: Reçu
		rule:
			role_id_e: no-role
		accuse_de_reception_action: accuse_de_reception
	
	accuse_de_reception:
		name-action: Accuser réception
		name: Accusé réception
		rule:
			last-action:
				recu
			role_id_e: lecteur
			droit_id_u: 'gf-commande:edition'
			
		action-class: AccuserReception
			
	creer_bdc:
		name-action: Créer le bon de commande
		name: Création d'un bon de commande
		rule:
			last-action:
				accuse_de_reception
			role_id_e: lecteur
			droit_id_u: 'gf-commande:edition'	
		action-class: CreerBdc
		editable-content:
			message_commande
			bon_de_commande
	
	modif_bcd:
		name-action: Modifier le bon de commande
		name: Édition du bon de commande
		rule:
			last-action:
				creer_bdc
				modif_bcd
			role_id_e: lecteur
			droit_id_u: 'gf-commande:edition'
		editable-content:
			message_commande
			bon_de_commande
		action-class: ModifBdc
	
	envoie_bdc:
		name-action: Signer le bon de commande
		name: Bon de commande envoyé au parapheur
		rule:
			last-action:
				creer_bdc
				modif_bcd
			document_is_valide: true
			role_id_e: lecteur
			droit_id_u: 'gf-commande:edition'
		action-class: SignerBdc
		
	verif-iparapheur:
		name-action: Vérifier le statut de signature
		name: Signature vérifié
		rule:
			last-action:
				envoie_bdc
			role_id_e: lecteur
			droit_id_u: 'gf-commande:edition'
		
		action-class: IParapheurRecup	
			
	recu-iparapheur:
		name: Signature récuperée
		rule:
			role_id_e: no-role
	
	envoie_bdc_fournisseur:
		name-action: Envoyer le bon de commande au fournisseur
		name: Bon de commande envoyé au fournisseur
		rule:
			last-action:
				recu-iparapheur
			role_id_e: lecteur
			droit_id_u: 'gf-commande:edition'
		action-class: EnvoieBdc	
	
	reception-bdc:
		name: Bon de commande reçu
		rule:
			role_id_e: no-role
			
	creer_facture:
		name-action: Créer la facture
		name: Création de la facture
		rule:
			last-action:
				reception-bdc
			role_id_e: editeur
			droit_id_u: 'gf-commande:edition'	
		action-class: CreerFacture
		editable-content:
			message_facture
			facture
	
	modif_facture:
		name-action: Modifier la facture
		name: Édition de la facture
		rule:
			last-action:
				creer_facture
				modif_facture
			role_id_e: editeur
			droit_id_u: 'gf-commande:edition'
		editable-content:
			message_facture
			facture
		action-class: ModifFacture
	
	envoie_facture:
		name-action: Envoyer la facture
		name: Facture envoyé
		rule:
			last-action:
				modif_facture
				creer_facture
			document_is_valide: true
			role_id_e: editeur
			droit_id_u: 'gf-commande:edition'
		action-class: EnvoieFacture
		
	reception-facture:
		name: Facture reçue
		rule:
			role_id_e: no-role
			
	envoie_facture_signature:
		name-action: Signer la facture
		name: Facture envoyé au parapheur
		rule:
			last-action:
				reception-facture
			role_id_e: lecteur
			droit_id_u: 'gf-commande:edition'
		action-class: SignerFacture
		
	verif-iparapheur-facture:
		name-action: Vérifier le statut de signature
		name: Signature vérifié
		rule:
			last-action:
				envoie_facture_signature
			role_id_e: lecteur
			droit_id_u: 'gf-commande:edition'
		
		action-class: IParapheurRecupFacture
			
	recu-iparapheur-facture:
		name: Signature récuperée
		rule:
			role_id_e: no-role
	
	send-ged:		
		name-action: Verser en GED
		name: Versé en GED
			
		rule:
			last-action: 
				recu-iparapheur-facture
			role_id_e: lecteur
			droit_id_u: 'gf-commande:edition'

		action-class: Defaut
	