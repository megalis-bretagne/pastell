nom: Helios 

type: Flux Généraux

connecteur:
	SAE
	TdT
	signature


affiche_one: true

formulaire:
	PES:
		iparapheur_type: 
			name: Type iParapheur
			no-show: true
			read-only: true
			type: externalData
			default: PES
			
		iparapheur_sous_type:
			name: Sous Type iParapheur
			requis: true
			read-only: true
			type: externalData
			choice-action: iparapheur-sous-type
			link_name: liste des types
			
		Objet: {requis: true, title: true}	
		fichier_pes: {name: Fichier PES, type: file, requis: true, commentaire: "format XML"}
		visuel_pdf: {name: Visuel PDF, type: file, requis: true, commentaire: "format PDF"}
		tedetis_transaction_id: {no-show: true}
	
	Historique:
		has_historique: {no-show: true}
		iparapheur_historique: {name: Historique iparapheur, type: file }
	
	Signature:
		has_signature: {no-show: true}
		fichier_pes_signe: {name: Fichier PES signé, type: file}
		document_signe: {name: Bordereau de signature, type: file}
	
		
	Reponse:
		has_reponse: {no-show: true}
		fichier_reponse: {name: Fichier réponse, type: file}


page-condition:

	Historique:
		has_historique: true
	
	Signature:
		has_signature: true
		
	Reponse:
		has_reponse: true

action:
	creation:		
		name-action: Créer
		name: Créé
		
		rule:
			no-last-action:
			droit_id_u: 'helios:edition'
			type_id_e: 
				service
				collectivite
		
	modification:	
		name-action: Modifier
		name: En cours de rédaction
		
		rule:
			last-action: 
				creation
				modification
			no-action:
				send-tdt
			role_id_e: editeur
			droit_id_u: 'helios:edition'

	supression:
		name-action: Supprimer
		name: Supprimé
		
		rule:
			last-action: 
				creation
				modification
				recu-iparapheur
				rejet-iparapheur
				tdt-error
				refus-tdt
				erreur-verif-iparapheur
			no-action:
				send-tdt
			role_id_e: editeur
			droit_id_u: 'helios:edition'
		action-class: Supprimer
		warning: "Êtes-vous sûr ?"
	
	send-iparapheur:
		name-action: Transmettre au parapheur
		name: Transmis au parapheur
		
		rule:
			last-action: 
				creation
				modification
			droit_id_u: 'helios:edition'
			document_is_valide: true
			
		action-class: IParapheurEnvoieHelios
		action-automatique: verif-iparapheur
								 	
	verif-iparapheur:
		name-action: Vérifier le statut de signature
		name: Vérification de la signature
		rule:
			last-action:
				erreur-verif-iparapheur
				send-iparapheur
			role_id_e: editeur
			droit_id_u: 'helios:edition'
		action-class: IParapheurRecupHelios
	
	erreur-verif-iparapheur:
		name: Erreur lors de la vérification du statut de signature
		rule:
			role_id_e: no-role
	
	recu-iparapheur:
		name: Signature récuperée
		rule:
			role_id_e: no-role
	
	rejet-iparapheur:
		name: Signature refusée
		rule: 
			role_id_e: no-role
		
	send-tdt:
		name-action: Transmettre au TdT
		name: Transmis au TdT
		
		rule:
			last-action: 
				recu-iparapheur
			role_id_e: editeur
			droit_id_u: 'helios:edition'
				
		action-class: TedetisEnvoieHelios
		action-automatique: verif-tdt
		
	verif-tdt:
		name-action: Vérifier le statut de la transaction
		name: Statut vérifié par le TdT		
		rule:
			last-action:
				send-tdt
			role_id_e: editeur
			droit_id_u: 'helios:edition'
		action-class: TedetisRecupHelios
	
	
	acquiter-tdt:
		name: Le fichier PES a été acquitté 
		rule:
			role_id_e: no-role
	
	refus-tdt:
		name: Le fichier PES a été refusé
		rule:
			role_id_e: no-role
			
	info-tdt:
		name: Un fichier de réponse PES est disponible
		rule:
			role_id_e: no-role
	
	tdt-error:
		name: Erreur sur le Tedetis
		rule:
			role_id_e: no-role					
			
	send-archive:
		name-action: Verser au SAE
		name: Versé au SAE
	
		rule:
			has-action:
				acquiter-tdt
				info-tdt
			no-action:
				send-archive
			role_id_e: editeur
			droit_id_u: 'helios:edition'
		action-class: SAEEnvoiHelios

	iparapheur-sous-type:
		name: Liste des sous-type iParapheur
		no-workflow: true
		rule: 
			role_id_e: no-role
		action-class: IparapheurSousType
			