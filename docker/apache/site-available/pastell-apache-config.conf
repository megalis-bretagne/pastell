<VirtualHost *:80>
    ServerAdmin root@localhost
    ServerName ${PASTELL_HOST}
    DocumentRoot /var/www/pastell/web/

    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ ${PASTELL_SITE_BASE}/$1 [L,R=301]
</VirtualHost>

<VirtualHost *:443>
    ServerAdmin root@localhost
    ServerName ${PASTELL_HOST}
    DocumentRoot /var/www/pastell/web/
    <Directory /var/www/pastell/web/>
        Options -Indexes +FollowSymLinks +MultiViews
        AllowOverride All
        Require all granted
     </Directory>

    #LOGS
    ErrorLog /data/log/pastell-error.log
    CustomLog /data/log/pastell-access.log combined

    #SSL
    SSLEngine on
    SSLCertificateFile /data/certificate/fullchain.pem
    SSLCertificateKeyFile /data/certificate/privkey.pem
	SSLCACertificatePath  /data/certificate/validca
    SSLOptions +StdEnvVars +OptRenegotiate +ExportCertData +LegacyDNStringFormat

    <If "osenv('TOGGLE_CertificateAuthentication') == 'true'">
         SSLVerifyClient optional
         SSLVerifyDepth 5
    </If>

    ProxyPass "/bl-xemwebviewer" http://pes-viewer:8888/bl-xemwebviewer
    ProxyPassReverse "/bl-xemwebviewer" http://pes-viewer:8888/bl-xemwebviewer

    ProxyPass "/libersign" http://libersign/libersign
    ProxyPassReverse "/libersign" http://libersign/libersign
</VirtualHost>